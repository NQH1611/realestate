<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
    <link rel="stylesheet" href="./css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.2/jquery.min.js"></script>

</head>

<body>
    <nav class="navbar navbar-expand-sm sticky-top  navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="#"><img src="./image/logo.svg" alt=""></a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                data-target="#navbar1">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- <div class="d-md-flex d-block flex-row mx-md-auto mx-0"> -->
            <div class="collapse navbar-collapse mr-auto" id="navbar1">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item ">
                        <a class="nav-link text-bold" href="./index.html">HOME</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-bold" href="./about.html">ABOUT</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-bold" href="./properties.html">PROPERTIES</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link text-bold" href="./post.html">POST</a>
                    </li>
                </ul>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="./login.html"><button
                                class="txt-login btn btn-success">LOGIN/LOGOUT</button></a>
                    </li>
                </ul>
            </div>
            <!-- </div> -->
        </div>
    </nav>
    <div class="container text-center mt-5">
        <h1>POST REAL ESTATE</h1>
        <div class="col-sm-12 row m-2">
            <div class="col-sm-6">
                <input type="text" name="" id="txtName" class="form-control m-2" placeholder="Tên Dự Án">
            </div>
            <div class="col-sm-6">
                <input type="text" name="" id="txtAdress" class="form-control m-2" placeholder="Địa Chỉ">
            </div>
        </div>
        <div class="col-sm-12 row m-2">
            <div class="col-sm-4">
                <select name="" class="form-control m-2" id="selectProvince">
                    <option value="0"> --- Province --- </option>
                </select>
            </div>
            <div class="col-sm-4">
                <select name="" class="form-control m-2" disabled="disabled" id="selectDistrict">
                    <option value="0"> --- District --- </option>
                </select>
            </div>
            <div class="col-sm-4">
                <select name="" class="form-control m-2" disabled="disabled" id="selectWard">
                    <option value="0"> --- Ward --- </option>
                </select>
            </div>
        </div>
        <div class="col-sm-12 row m-2">
            <div class="col-sm-6">
                <input type="text" name="" id="txtAcreage" class="form-control m-2" placeholder="Diện Tích">
            </div>
            <div class="col-sm-6">
                <input type="text" name="" id="txtNumFloor" class="form-control m-2" placeholder="Số Tầng">
            </div>
        </div>
        <div class="col-sm-12 row m-2">
            <div class="col-sm-6">
                <input type="text" name="" id="txtNumApartment" class="form-control m-2" placeholder="Số Căn Hộ">
            </div>
            <div class="col-sm-6">
                <input type="text" name="" id="txtPrice" class="form-control m-2" placeholder="Giá Tiền">
            </div>
        </div>
        <div class="col-sm-12">
            <div class="col-sm-12 m-2">
                <input type="file" name="" id="filePhoto" class="form-control m-2">
            </div>
        </div>
        <div class="col-sm-12">
            <div class="col-sm-12 m-2">
                <textarea name="" id="txtDescription" rows="4" class="form-control m-2" placeholder="Mô tả"></textarea>
            </div>
        </div>

        <input type="button" value="Post" class="btn btn-success btn-post w-25 m-2">
    </div>
    <hr>
    <div class="container-fluid mt-5">
        <div class="container">
            <div class="col-sm-12 row">
                <div class="col-sm-3">
                    <img src="./image/logo.svg" class="mt-3" width="50%" alt="">
                    <p class="mt-3">Properties are most budget friendly so you have are find opportunity is main
                        responsibility to clients</p>
                    <p class=" mt-5" style="font-size: 10px;">© CodeCarnival. All Rights Reserved - Privacy Policy
                    </p>
                </div>
                <div class="col-sm-3 text-center">
                    <h4>Information</h4>
                    <p>About us</p>
                    <p>Properties</p>
                    <p>Careers</p>
                    <p>Payment</p>
                    <p>Blog Post</p>
                </div>
                <div class="col-sm-3 text-center">
                    <h4>Support.</h4>
                    <p>Add Property</p>
                    <p>Terms & Conditions</p>
                    <p>Help line</p>
                    <p>Our Agents</p>
                    <p>features</p>
                </div>
                <div class="col-sm-3 text-center">
                    <h4>Address.</h4>
                    <p>2104 Charmaine Lane Amarillo, New York</p>
                    <div class="col-sm-12">
                        <div class="row">
                            <button class="btn mr-3" style="width: 60px; height: 50px;"><i class="fab fa-facebook"
                                    aria-hidden="true"></i></button>
                            &nbsp;
                            <button class="btn mr-3 " style="width: 60px; height: 50px;"><i class="fab fa-twitter"
                                    aria-hidden="true"></i></button>
                            &nbsp;
                            <button class="btn" style="width: 60px; height: 50px;"><i class="fab fa-instagram"
                                    aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    //kiem tra neu chua dang nhap se chuyen trang dang nhap
    //đã đăng nhập sẽ được vào trang đăng bài
    var token = sessionStorage.getItem("token");
    if (token == null || token == "") {
        alert("Hãy đăng nhập trước nhé!")
        window.location.href = "./login.html"
    } else {
        $(".txt-login").html(sessionStorage.getItem("username"))
    }
    $(".btn-post").on("click", function () {
        newProject = {
            id: 0,
            name: "",
            provinceId: "",
            districtId: "",
            wardId: "",
            streetId: "",
            address: "",
            slogan: "",
            description: "",
            constructArea: "",
            acreage: "",
            numBlock: "",
            numFloors: "",
            numApartment: "",
            apartmenttArea: "",
            investor: "",
            constructContractor: "",
            designUnit: "",
            utilities: "",
            regionLink: "",
            photo: "",
            lat: "",
            lng: "",
            price: "",
            status: 0,
            customer: window.sessionStorage.getItem("idcus"),
        }
        getData(newProject);
        console.log(newProject)
        if (validateData(newProject)) {
            const token = getCookie("token1")
            var headers = {
                Authorization: "Token " + token
            };
            $.ajax({
                url: "http://localhost:8080/projects",
                method: "POST",
                headers: headers,
                data: JSON.stringify(newProject),
                contentType: "application/json",
                success: (data) => {
                    alert("Project created successfully");
                }
            })
        }else{
            alert("Bạn hãy nhập đầy đủ thông tin")
        }
    })

    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }
    function getData(paramObj) {
        paramObj.name = $("#txtName").val()
        paramObj.address = $("#txtAdress").val()
        paramObj.acreage = $("#txtAcreage").val()
        paramObj.numFloors = $("txtNumFloor").val()
        paramObj.numApartment = $("#txtNumApartment").val()
        paramObj.price = $("#txtPrice").val()
        paramObj.photo = $("#filePhoto")[0].files[0].name
        paramObj.description = $("#txtDescription").val()
        paramObj.provinceId = $("#selectProvince").val()
        paramObj.districtId = $("#selectDistrict").val()
        paramObj.wardId = $("#selectWard").val()
    }
    function validateData(paramObj) {
        if (paramObj.name == "") {
            return false;
        } if (paramObj.address == "") {
            return false;
        } if (paramObj.acreage == "") {
            return false;
        }
        if (paramObj.numFloors == "") {
            return false;
        }
        if (paramObj.numApartment == "") {
            return false;
        } if (paramObj.photo == "") {
            return false
        }
        return true;
    }
    $(document).ready(function(){
        apiCallProvince()
        $("#selectProvince").on("change", function(){
            var province = $(this).find(":checked").val()
            apiCallDistrict(province)
        })
        $("#selectDistrict").on("change", function(){
            var district = $(this).find(":checked").val()
            apiCallWard(district)
        })
    })
    function apiCallProvince(){
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/province",
            dataType: "json",
            success: function (response) {
                for(var bIndex in response){
                    var html = `<option value="${response[bIndex].id}"> ${response[bIndex].name}</option>`
                    $("#selectProvince").append(html)
                }
            }
        });
    }
    function apiCallDistrict(paramProvince){
        $("#selectDistrict").html("")
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/district/"+paramProvince,
            dataType: "json",
            success: function (response) {
                $("#selectDistrict").removeAttr("disabled")
                for(var bIndex in response){
                    var html = `<option value="${response[bIndex].id}"> ${response[bIndex].name}</option>`
                    $("#selectDistrict").append(html)
                }
            }
        });
    }
    function apiCallWard(paramDistrict){
        $("#selectWard").html("")
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/ward/"+paramDistrict,
            dataType: "json",
            success: function (response) {
                $("#selectWard").removeAttr("disabled")
                for(var bIndex in response){
                    var html = `<option value="${response[bIndex].id}"> ${response[bIndex].name}</option>`
                    $("#selectWard").append(html)
                }
            }
        });
    }
</script>

</html>